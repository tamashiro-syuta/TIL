# Effective DevOps
## 読む前の知識
- DevOps = CI/CDとかdockerとかで開発しやすい環境を整えること
- なんか、SREに近しいことしてるイメージ

# 第1部 : devopsとは何か
## devopsの概要
- devopsは「文化」
- 文化をチームで共有、共感し、維持することが大切
- **devopsはCI/CDなどの効率化のための手段をさすものではなく、ビジネスが価値を実現するスピードを支援するためのより抽象度の高い概念や文化を指す言葉**
  - ❌ devopsは CI/CDの整備とかでしょ？
  - ⭕️ devopsはビジネスが価値を実現するスピードを支援するための文化

- devopsにおける問題の捉え方
  - ❌ 問題が起きたのは、それを起こした **"個人やチーム"** のせいだ
  - ⭕️ 問題が起きたのは、それを起こした **"仕組み"** のせいだ

## 基本的用語と概念
出てきた単語の中で、知らなかった、もしくは、知識が薄かったり認識がズレていたものをピックアップ
- アジャイル
  - ソフトウェア開発の手法の一つ
  - アジャイルは開発手法
  - devopsは文化そのもの
- リーン
  - 価値を与える部分に注目し、他の全ての無駄を取り除くことに全力を注ぐという考え方
  - これをITに置き換えた「リーンIT」という考え方では、以下の無駄を取り除くことが重要とされている。
    - ソフトウェアの不要な機能
    - 通信遅延
    - アプリケーションの応答の遅さ
    - 高圧的で官僚主義なプロセス
- 継続的インテグレーション(CI)
  - CIは、プロセスのことを指す
  - 自動テストなどはCIの一部で、概念全体を表しているわけではなく、あくまでもCIを構成する一部
  - CIの本質は、細かく統合することで、大規模で頻度の低いマージが引き起こす問題を防ぐこと
- レトロスペクティブ
  - **プロジェクト終了後に行う** 振り返りの議論のこと
  - 以下の観点で振り返りを行う
    1. 何が起きたか
    2. 何がうまくいったか
    3. 何がうまくいかなかったか
- ポストモーテム
  - **問題が発生した後に行う** 振り返りの議論のこと
  - ポストモーテムは、問題の原因を特定し、再発を防ぐための対策を講じるために行われる
  - 以下の観点で振り返りを行う
    1. 何が起きたか
    2. 報告
    3. 改善事項
  - **人を非難せず、建設的に原因を探ることに重点を置いている**
    - 懲罰 <<<< 学習
  - レトロスペクティブとポストモーテムの違い
    - レトロスペクティブ : プロジェクト終了後に行う振り返り(定期)
    - ポストモーテム : 問題が発生した後に行う振り返り(不定期)
- 組織的な学習
  - 組織的な学習とは、組織が持つ知識を集め、成長させ、共有するプロセス
  > 「学習は、仕組みに組み込み、仕事と並行して進めるべきプロセス」

## devopsに対する誤解
- devopsに関係があるのは開発者とシステム管理者だけ
  - devopsの外ねとアイデアには、**組織内のすべての職能が含まれる**
  - ❌ devopsの適用範囲を過小評価するのは良くない

- devopsはチームである
  - devopsは文化
  - チームを作ってそこに丸投げして、解決される問題ではない
    - **※ devopsには正解はないので、チームを作ること自体が悪ではなく、そのチームがいるから私たちはdevopsをやっているという誤解が問題**
    - 大事なのは、**組織で同じミッションを共有し各チームが他チームと共同しつつ役割を全うできること**
    - 経営層は、そのためにチームの明確な役割と責任を示す必要がある

- devopsには「正しい方法(または間違った方法)」がある
  - devopsには正解はない
  - devopsがうまくいっている企業の施策をそのままマネするのはアンチパターン
  - うまくいっている原因を突き止めて、それを自分の組織にうまく応用するのが大事

- devopsを取り入れるためにはn週間必要
  - devopsは継続的なプロセス
  - devopsに終わりはない

- 「devops = 自動化」である
  - 自動化はdevopsの手段の一部でしかない
  - 自動化するにあたっては、自動化にかける時間を意識することが大切
    - 自動化にかける時間の方が短縮した時間より長ければ自動化しない方がよい
  - 相互にコンテキストの理解や配慮がなければ、自動化は未知のリスクを増やすことにもなる
  - 大切なのは、透明性やコラボレーションの水準を上げて理解を促進すること

## devopsのアンチパターン
- ❌ 非難文化
  - 人を非難するのは良くない、その裏にある仕組みや原因を疑え
  - 非難文化がある = 透明性がない環境 = オープンでコラボレーションを尊重していない

- ❌ サイロ
  - 他のチームと協力、ナレッジの共有をする文化がないこと
  - 解決策として、職能横断型のチームが挙げられるが、これだけでは不十分
    - **チームの構成員が他のチームとのコミュニケーションを取ることが重要**

- ❌ 根本的原因分析
  - 「なぜ？」を5回繰り返したりするやつとかの手法
    - 結果として、ヒューマンエラーを原因としがち(アンチパターン)
  - デメリットは、問題の原因が1つしか特定できないこと
    - 複雑なシステムでは、いくつかの要因が重なり合って問題が起きていることが多いので、しすてむには不向きであることが多い

***

# 第2部 : コラボレーション
## コラボレーションの定義
- コラボレーションとは、**一緒に働く人たちのあいだで対話、教育、支援をしながら具体的な結果を生み出そうとするプロセス**
  - コラボレーションの範囲は個人の意識的なプロセスや共通の目的にまでと結構幅広い = 「なんで働くの？」から「働くときはこう考えながらしているぜ」とか、「わたしはこういう属性の人だぜ」まで多岐に渡る
- コラボレーションの例
  - 非同期でのコードレビュー
  - ドキュメント作成
  - 問題の更新とバグレポート
  - ペアプロ
- 良いコラボレーションの条件
  - コミュニケーション
  - 平等な参加
  - 心の理論(多様性を認める心)

## コラボレーションで考慮すること
- 個人の違いを尊重！！
  - どんな違いがあるのか？？
    - バックグラウンド
      - 前職の経験や、会社の規模、職種、業界など
    - 働く目的
      - お金のために働く、家族を養うために働く、やる気満々で働くなど
    - 認知スタイル
      - 内向的か外交的か、理想論者か現実主義者か、アイデアマンか正確性を求める人かなど
  - 同僚との違いについて理解し、リスペクトを持って接するのが大事
  - 個人間の信頼がないと、社員の間に信頼感は生まれない
  - 意外と大事なのは「働くモチベ」も違うことを理解する！！！！！
    - ex)「やる気満々」もいれいば「お金のために働く」「家族を養うんだ！」まで様々
    - 働く目的が異なる人たちを認め、最適なタスクを割り当てることが大事(育成面でも大事)
    - それがメンバーの不満削減、パフォーマンス向上による人材配置の最適化につながる！！！
  - 採用では特に「認知スタイル」を中心に社内にいる人材のバランスを考えていくことで多様性のあるチームを作ることができる

## 競争優位を得るために必要な3つのチャンス
1. メンターシップ
    - 本物の熟練したエンジニアは、指導や教育に力を入れない環境からは生まれない。
    - メンターシップを整えることで以下のメリットがある
      - 若手が育つ
      - 離職率の低下
    - メンター側が十分なコミュニケーションスキル、教える能力、他者の学習を助けるのに必要な忍耐力を持っている必要がある
    - 重要なのは **『メンター、メンティーの両方が目的や役割、義務について理解していること』**
2. スポンサーシップ
    - メンターとは別に、若手を引っ張り上げる支援者(スポンサー)が必要
    - 支援者と非支援者は、WinWinの関係
    - 支援者と非支援者の好循環を仕組みとしてどう作るかが大切
3. 教育
    - 「教育するともっと良い待遇の企業にヘッドハンティングされそう」は間違い
    - ほっておいても優秀な人はもっと良い企業にするので、その考えのままだと最悪「やる気がある人がいなくなり、やる気がない人だけが残る」という状態になる
    - **「転職できるぐらいに訓練し、転職したいと思わないくらいに厚遇にせよ」** by リチャード・ブランソン

## マインドセット
- チーム全体で成長志向になる必要がある
  - 固定思考 : 能力は生まれながらに一定、失敗は避けるべき
  - 成長思考 : 大体のことは努力で変えられる、失敗は学びの機会
- 成長志向を育てる6つの方法 ← 自己肯定感を高めることと全体的に似ている
  - 基本を学ぶ
    - すぐに結果を出させようとせず、「基本」を学ぶことを重視
    - 全体を俯瞰してみることで、組織に必要なことや組織の重要なポイント、キーパーソンなどを見極めて、どこで自分が活躍するべきかがわかる
  - ニッチを開発する
    - 全部で勝とうとせず、自分が勝てるポイントを見極める
    - 大事なのは、自分が勝てるポイントは今自分に備わっているかは関係ない！！！
    - チームやプロダクトに必要なポイントを見極めて、後から身につける！！！
      - ↑ 他人に成長思考を身につけさせる上では、この「後から身につければいいんだよ」ってところが大事そう
  - 自分の得意なことを知り、それを伸ばす
    - 自分の得意分野を伸ばす上で、大事なのは、評価を他人ではなく自分自身で行うこと
  - 意識的で質の高い実践を心がける
    - 間違ったやり方を繰り返しても意味はない
    - 難しいのは、慣れているからという理由で時代遅れになったものを使い続けることから抜け出すこと(サンクコストに縛られない)
    - **仕事の品質を保ち、非日常的な事象に反応できる能力を維持しよう。そのためには、新しいスキルを学んだり、既存のスキルを強化したりして、絶えず自分自身に課題を与え、自分自身を向上させていかなければいけない**
  - 作業スタイルを開発する
    - 他者のおすすめのツールなどを使ってみながら、自分に合うスタイルをつくろうね
  - チームスタイルを拡張する
    - 個人のスタイルとチームのスタイルのいいバランス取っていこうね

## フィードバックの役割と制度
- FBによって固定思考から成長思考に変わるチャンスが生まれる
- **FBの対象は "努力", "行動", "成果", "思考"**
  - 固定思考へ促すFB : **生まれつきの性質や変更不能な事実を暗示**
    - 「君は賢いね」
    - 「君は人付き合いが苦手だね」
  - 成長思考へ促すFB : **行動に着目し、将来すべきことに焦点を当てる**
    - 「〇〇について努力してきたことが伝わる」
    - 「〇〇をすればもっと良くなると思う」
- 次のアクションに繋がるFBは、頻繁に行った方が良い
  - FBもアジャイルに！！
  - FBを高速に回すことで、問題への対処も早くなる
  - 逆に言えば、次に繋がらないFBはやらない方が良い
- 業績をランキングで出すのはあまり良い評価制度とは言えない
  - ランキング制度は、チームの協力を妨げる = コラボレーションを阻害しチーム全体での生産性を下げることになる
  - 個人評価 + チーム評価のバランスが大事
- シゴデキ社員への対応
  - 1人のスーパースターへの例外的な対応は、チーム全体の生産性を下げる
  - スーパースターがいることは構わないが、あくまでもチーム全体の生産性を上げることが大事
  - チームの中で共感を育て、協力していく体制が大事
    - **良いチームには、「社会的感受性」「相手の気持ちや一般的な社会規範を理解する力」「コミュニケーション能力」が必要**

## 共感と信頼
- コラボレーションを図るには、"共感" と "信頼" が必須
- 共感
  - 共感能力は後天的に育てられるし、育てなければならない！！！
  - 共感能力が高い人は、意見の不一致があっても、他者に寄り添い、妥協点を見つけることができる
  - 共感力を身につける方法
    - アクティブリスニングを用いて、話聞く
      - 話者に対してオウム返しで返答したり、話の内容を要約してみたりする
      - 話の意図を確認するため、質問する
      - ↑どちらもこちらから、共感しに行ってる！！
    - 個人的な違いを尊重
      - 話者に対して「自分とは異なる意見の人と対話している」という意識を持つ
- 信頼
  - 「信頼しつつ確認」が最強
    - 最初に信頼をおいて責任を共有する方向に踏み込み、あとから信頼が妥当なものか確認する
  - 信頼できるような公平な環境を保つことも大事
    - 責任やリソースに加えて、 **リスクも共有** することで有事の際に片方に皺寄せがいくこともなくなる
    - メンバー間に階層構造がなく、フラットな環境である方が公平性も保ちやすい

## 人材配置と人事管理
- メンバーのワークライフバランスを考慮するのも、devopsでは大事
  - devopsは、持続可能な作業環境を作り出すことであり、それぞれの人がワークライフバランスをどう実現するかはdevopsの重要なテーマ
  - devopsは思ったより範囲が広い！！！！
- 社員の長期的な健康より、企業の目先の金銭的物質利益を優先するなら、長期的には損失を生み出すだろう！！！

## コラボレーションに対する誤解
- ❌ 急成長したい時には「人間性に問題はあるがスキルはすごい人」を採用しても良い
  - 企業を軌道に乗せるにはチーム全体の成長が必要だが、人間性に問題がある人物はチーム全体の成長を阻害する(どんなにスキルがあってもダメ)
  - **「信頼、共感、相互性がない企業は長期的には衰退する」**
- ❌ 多様性に満ちたチームは効果的にコラボレーションしない
  - 短期的には対立が増えるが、長期的には創造性や問題解決能力が高くなる

## コラボレーションのよくある問題とその解決方法
- メンバーがタスクをこなせていない
  - まずは、職務と責任を明確にする
    - チームとメンバー間で認識のズレが起きていないかをここで確認する
    - ⚠️ **メンバーが燃え尽き燃え尽きている場合は、個人だけでなく組織的な問題である可能性が高いので注意**
  - メンバーの職務と責任を明確にした後に、それがメンバーに達成可能かを評価する
    - この時、実力不足であれば、教育やトレーニングを行い、それに必要な時間やリソースも加味して評価する
    - 教育やトレーニングを行うリソースが組織内にない場合は、その事実をメンバーに共有し、どのような対応をとるかメンバー自身に決断させることが大切
      - メンバーのほっとかれている感も無くなるし、自信で決断させることでメンバーの納得感にも繋がる
  - また、第三者からタスクをこなせていないと報告があった場合は、データに基づいて評価する
    - データに基づいて評価することで、感情的な問題を避けることができる
- コミュニケーションが不十分な人がいる
  - コミュニケーションの必要性を普及しているのに積極的になれない人がいる = **他者を信頼できない気持ちが働いている可能性がある**
  - ↑ かつて非難文化のある組織で働いていた人に多い
  - 文化の切り替えには時間がかかるので仕方ないことではある
  - **非難のないポストモーテムを公開で実施し、非難文化のない評価を続ける**ことでうまく行く場合がある
- 「人間性に問題はあるがスキルはすごい人」がいる
  - 「人間性に問題はあるがスキルはすごい人」を図る基準
    - この人がきっかけで辞めた人がいる
    - この人の人間性が原因で他者の仕事にマイナスが出ることがある
    - この人が少数派の人たちに悪影響を与えることがある
      - ex)「〇〇君、男なのに育休そんなにとるの？」
    - この人がドキュメントを書くのを拒否した結果、不要なデバッグ時間が増えたりした
  - **多くの場合、このような人物が組織のためにすることは、技術的にも文化的にも、とうてい「価値がある」レベルとが言えない**
- チーム内での影響力が小さい
  - これは問題内容というよりは、個人的に有用な部分があったのでメモ
  - ジュニアや新人の場合は、仕事やコミュニケーションスタイルを変えることで大きな効果が出ることもある。
  - 組織内でメンターを見つけられると、そういったスキルを伸ばす上で役に立つ

***

# 第3部 : アフィニティ(親近感、一体感)
## アフィニティの定義
- アフィニティは、あらゆるチーム間の関係の強さの尺度
- チーム内の結びつきを強くするには、以下の4つの要素を全て満たす必要がある
  - **『共有する時間』**
  - **『関係の強度』**
    困難な状況を克服したり解決したりすることで結束する
  - **『ストーリーの相互共有』**
    - 個人的な成功や逆光を共有することで相互理解を図る
  - **『助け合い』**
    - 休暇中のカバーなどで助け合うことで、チーム全体の結束を強める

## チームの文化
- **チームが共有する価値観としての文化と、それらの価値観が仕事の中でどのように表現されているかが重要**
- チーム内での意見の対立(特にどちらの言い分も間違っていない場合)でも、価値観が共有されていれば、どちらの意見を正しいとするかの判断ができる
- 大切なのは、チーム全体の価値観と個人の価値観が矛盾しないこと
- 価値観に一致するか？の評価で注意すべきは、**「価値観」や「カルチャーフィット」などの言葉がチームの同質性を保つための手段になっていないか？**
  - 「価値観」という言葉が「業務を進める際に必要な価値観」という意味で使われていることが大事
  - ex)「この人は、ノリが合わなそうだから採用はやめておこう」

## チームの団結力
- チームの団結力 = チームに貢献したいと思う度合い
- 団結力が強さによる比較
  | 団結力 | 弱い | 強い |
  |:-----------|:------------:|:------------:|
  | 信頼感       | 低い        | 高い       |
  | 知識の共有     | 少ない      | 多い      |
  | 共感       | 薄い        | 厚い
  | 生産性         | 低い(足し算)          | 高い(掛け算)          |
- **団結力には「他チームへの協力体制」という前提があるのは忘れてはいけない！！！**
  - devopsの目的は「ストーリーを共有し、共感を育み、個人とチームが効果的かつ永続的に力を出せるようにすること」
  - チーム内の団結力が強すぎるあまり、他チームへの協力体制が弱まっては本末転倒
  - 強くなりすぎると、会社の予算など資源を競い合うようになり、他チームを敵対視する空気ができてしまうケースがある
    - ex) 営業チームが強すぎるが故に「開発チームは営業チームが言った仕様を作るもの」と思うメンバーが出てきて、チーム間で建設的な議論ができなくなる
  - これは、職務の間に階層構造ができている組織におきがちな問題
  - 職務が異なるメンバーの交流機会を増やすことで、他チームへの理解を示す効果がある
  - ↑ ※ ただし強制的ではなくあくまでも、メンバーの興味や関心によってグループが形成されるように任せ、機会を与えるに留めるのが大切

## チーム間で共通な地盤を見つける
- devops文化は、組織構造と互いに影響を与え合っている
  - 組織内で競合するPJがある or チーム間で重複したタスクがある → チーム間のコミュニケーションと理解の欠如
- devops文化では、**顧客に対する共感を育てること** も重要
  - そのためにチーム間は協力するべき
- チーム間で協力する際に有用な手法を紹介

### 指名運用エンジニア
- ⚠️ ある程度、運用チームの人数がいないと成り立たないので注意
- 各PJに対して、運用チームから1人ずつ指名して担当をつける
- 指名されたエンジニアは、PJに関する会議などに出席し、定期的にコミュニケーションを取る
- メリット
  - 運用"チーム"に投げていた問題を担当(窓口)を設けることで、PJの問題やコンテキストの共有コストを削減
  - 定期的にコミュニケーションを取ることで問題になりそうな事象を早めにキャッチできる
    - ex) APIエンドポイントが追加される場合に、APIクラスタの負荷増加が見込まれるので早めに対処できる
  - チャットのみのやり取りでなく名前と顔が一致することで、コミュニケーションが円滑になり、お互いのチームへのリスペクトにつながる
  - 新しい知識を学習する機会が増え、それぞれのチーム間の垣根が薄れて行く

### ブートキャンプ
- 社員が数週間程度、別チームで働く
- 指名運用エンジニアと同じメリットが得られる
- エンジニアがサポートチームとして、メール対応や苦情対応をするサポートローテーションも良い効果が得られる
  - コストセンターとして見られがちなサポートチームの大切さを理解するのは重要
  - 実際に働くことで
    - サポートチームの負担やストレスを理解し、それに対する共感を持つことができる
    - サポートチームをキャリアラダーの下層とせず、一つの組織を構成する重要な役割と認識できる

## チームのコミュニケーションの改善
- コミュニケーションは足りないよりは、多すぎる方が良い
  - 情報が足りないと、チーム間の隔たりが強くなりやすい
- 危機状況下でのコミュニケーションテクニック
  - Two Challenge ルール
    - 疑問に思うことは2回まで質問して良い
    - 特に危機状況では疑問を安心して発言できることが大切になる
  - CUS
    - 下記の3つの場合は発言した方が良い！
      - C : Concern(懸念がある)
      - U : Unsure(不確実なことがある)
      - S : Safety(安全性に問題がある)
  - SBAR
    - 下記のフォーマットで説明すると良い！
      - Situational(何が起きている？)
      - Background(それを理解するのに必要な背景)
      - Assessment(問題点はどこ？)
      - Recommendation(どうすればいい？かの提案)

## アフィニティに必要なもの
### 遊び(バッファ)
- 遊び(バッファ)は、ワークライフバランスと個人の健康維持に重要な意味を持っている
- 割り込みの仕事が多いチームではより多めに設定する必要がある

### ソフトスキルに対する明示的な目標と価値観、評価
- スキルマトリックスなどには、ソフトスキルに対する評価基準も明示的に記載するべき
- 記載し、実際に評価対象に含めることで、ソフトスキルが評価される文化を醸成する
- ソフトスキルも評価対象に入る = スキルはあるが人間性に難があるタイプの人材は評価されにくくなり、結果として組織全体のアフィニティが向上する

### スペース
- オフィスに共有の休憩スペースを設けることで、チーム間のコミュニケーションが増える
- ※ 共有スペースで、あるチームの方が他チームより優先されるようなことはNG

### コラボレーションと協力
- アフィニティのすべてのメリットを享受したいなら、人間関係を構築するための仕事や行動を推進し評価する文化を持たなければならない

## アフィニティの計測
- そもそもアフィニティ自体の計測は難しいので、アフィニティの結果を評価する
- 社員のスキルと評価
  - 前述しているが、評価項目に明示的にソフトスキルを含めることで、アフィニティの向上を評価することができる
  - コミュニケーションにおいては、量よりも質の方が重要
  - コミュニケーション能力が優れている人 = GIVER
- チーム間の交渉
  - 個別のチーム内で良好なコミュニケーションが取れているのに、チーム間では取れていない = どこかに問題がある証拠
- コミュニティへの返礼
  - カンファレンスの公演、ブログ記事などコミュニティの利益に乗っかっている場合は、そのコミュニティにお返しをするべき
  - タダ乗りはNG!!!

## アフィニティに対する誤解
- ❌ 外部と共有しすぎると競争優位性が弱まる
  - むしろ逆！！！！！
  - 自分たちがどのように商品を作り、サポートしているのかを共有しているだけで、競争優位性となる秘伝のタレのようなものを公開しているわけではない
  - むしろ、エンジニア採用は難しいので、そういったことをオープンに行っていないことは、採用面でもマイナスに作用する

## アフィニティの問題解決
- ひとりまたは複数の個人がグループフローを妨害する
  - まずは、原因の特定から行う
    - この時、原因はあくまでも行動であり、特定の個人ではない(反非難文化)
    - なぜ、妨害する行動を取るのかを理解することから始める
    - だいたい、力関係、やり場のない不満、対立が多い
  - その個人に対して、そのような行動に対してどのように責任を取らないといけないかを理解させる必要がある！！！！
    - この時、ちゃんとしてルールに則って責任を取らせるのが大事
    - 主観じゃないよ、ルールなんだよを理解してもらう
- あるチームが別のチームの仕事を止めてしまう
  - お互いのチームの仕事について理解していないことが多い
    - ex) チームの問題、PJの概要、要件、KPIなど
    - 特にKPIが異なることを理解できていない場合が多い
  - 総じて、**コミュニケーション不足が原因**
  - チーム内でのタスクの引き継ぎやチーム間のコミュニケーションでは以下を意識するのが大切
    - **何をしなければいけないのか？(What)**
    - **納期はいつか？(Limit)**
    - **タスクを行う理由、背景(Context)**
    - **タスクの優先順位(Priority)**
  - **お互いに同じ企業のために働いており、同じ目標を持っていることを理解することが大事**
- 互いに信頼していないように見える
  - 信頼していない環境 = 職場の文化に問題がある
  - 組織全体で信頼を築くには、**開かれたコミュニケーション** が大切
    - ex) 社員からの匿名の質問を募り、その中から社員が選んだ質問を管理職が答える制度など
  - 組織的に信頼を築けるようになったら、小さい単位から組織での交流を促すようにする
    - 最初は、業務に関係のないことを希望者から無作為に集めたチームで行う
    - 慣れたら、小さくて優先度の低いタスクからチームで行っていく
- サイロに閉じ籠りたがるチームがある
  - 過去の経験から、過去の問題に対する反射的な対応として起きている場合がある
  - その場合、過去の経験からチーム全体のニーズを紐解き、解決するアプローチが必要
- devopsの些細な過ちを強く非難する人がいる
  - そもそもdevopsは、絶えず継続して行うもので最初のうちに改善点が出てくるのは当然
  - トップがそれを理解し、合わせてdevopsへの支援を行うことが大事

***

# 第4部 : ツール
- ツールはあくまでも手段であり、目的ではない
- ツールを選ぶ際には、**「ツールが組織のdevops文化にどう影響を与えるか？」** が重要
  - ❌「この機能があるから良い」
  - ⭕️「この機能があるから、コラボレーションが進む」
- **devopsのツールは「私」よりも「私たち」を強調する**

## 基本的用語と概念
- アーティファクト管理
  - 広い意味で成果物を管理するための方法を指す
    - ex) ECRのリポジトリで成果物をdocker imageとして保存しているのもアーティファクト管理
- 構成ドリフト
  - サーバーが時間とともにあるべき構成から離れていくこと
  - ❌ アンチパターン
- スノーフレークサーバー
  - 多くの手作業であるべき姿になったサーバー
  - ❌ アンチパターン
- スモークテスト
  - 合理的な出力が得られるかどうかを判定するテスト
  - ざっくりいうと「この機能、ちゃんと動くよね？」「やばいとこ無いよね？」を確認するテスト
- リグレッションテスト
  - 変更によって新たなバグやエラーがないかを確認するテスト
  - CIでテストを行うのも、リグレッションテストにあたる
  - ざっくりいうと「機能追加(or修正)してpushしたけどちゃんと動くよね？」を確認するテスト
- ユーザビリティテスト
  - ユーザーに実際に操作させ、目的を果たせているかを確認するテスト

## インフラ自動化のメリット
意外と多かったw
- 反復可能
- ドキュメントがしっかりしている
- 監査対応もできる
- 回復力が高い
- 柔軟性の向上
- リスク計測がしやすい

## アラート設計
アラート設計で考慮すべき点
- 影響
  - **アラートは影響が大きいもののみに制限すべき**
  - 慣れで無視しがちなアラートは、アラートの意味が薄れてしまう
- 緊急性と当事者
  - **ステークホルダーに応じて、①適切な通知先と②送るアラートの緊急度を設定する必要がある**
  - ステークホルダーによってどの通知が緊急性が高いかが異なる
- リソースとコスト
  - **このインシデントに対応するには、どの程度のリソースが必要か？**を意識する
  - 対応できるくらいのリソースが組織内にあるかどうかを確認して、必要があれば体制を整える
  - モニタリングやアラートにはコストがかかるので、システムの重要度などに応じてどこまで対応するかを決める

## イベント
- **100%正確なアラートシステムはない。偽陽性、偽陰性のどちらにもコストがかかる。**
  - 偽陽性 : 実際には問題がないのにアラートが出る
    - アラートを無視するようになり、本当の問題が発生した時に対応が遅れる(オオカミ少年状態)
  - 偽陰性 : 実際に問題があるのにアラートが出ない
- **アラートは一回設計したら終わりではなく、システムの状況に合わせて適宜チューニングする必要がある**
  - システムの状況によって、かつて問題だったことが問題でなくなったり、その逆になることもある
  - **絶え間ない変化への対応は、アラート、インシデント管理では重要な要素**

## 文化を加速させるもの
- ツールは定期的に評価し、必要に応じて変更する
  - 組織のフェーズなどで使うべきツールは変化する
  - 合わないツールを削減することによるメリット
    - ツール起因の不要なタスクの削減
    - コスト削減
- ツールを導入する際に、個人的な興味・関心で導入するのは良くない
  - 必ずツールを評価する調達プロセスを入れるべき
  - ツールを選ぶ際には、**「ツールが組織のdevops文化にどう影響を与えるか？」** が重要
  - それを必ず評価できるように、ツールの導入には調達プロセスを入れるべき
- ツールの導入に不向きな部署もあるので、必ず全社導入すべきとかではない。柔軟に決めた方が良い。
- 特定のツールを使いたい個人との対話では **「使いたがっているツールでもちゃんと問題を解決できるのか？」** を基準に判断するのが良い
- ツールの評価は **SMART** に！
  - **S : Specific(具体的)**
  - **M : Measurable(測定可能)**
  - **A : Achievable(達成可能)**
  - **R : Realistic(現実的)**
  - **T : Time-bound(期限付き)**
  - SMARTに沿って、部品を細かく分解して評価することで、より評価しやすくなる
- 「ツールの導入に成功した(devops文化に良い影響を与えた)」の基準を作る際の観点
  1. ツール選択についての意思決定の責任者は誰か？
      - amazonでも、責任者はバイネームで決めているらしい(聞いた話だが、たぶんそう)
  2. ツールとその使い方を選択し評価する時、どの基準を使うか？
  3. エンジニアの幸福と顧客の幸福の両方のために何を優先させるか？
- 大事なのはどのツールを選択したか？ではなく **「このツールを選択する際、どのようなことを考え、どのようなトレードオフを秤にかけたか、使うツールについての判断をどのようにまとめたか？」**

- ツールの成功の測定には **「透明性」** と **「モニタリング」** が大事！！！
  - **透明性**
    - 計測したデータを誰でも閲覧できるようにすること
  - **モニタリング**
    - システムレベルのパフォーマンスからビジネスレベルのメトリクスまで、可能な限りデータを継続的に収集すること
    - モニタリングしたデータを透明性を持って公開することで、プラットフォームを持続的な形で運営できる!
    - ポイントは **一気に導入するのではなく、顧客にとって一番大きな影響を与える部分から計測していき、PDCAを回して自社に合う最適なモニタリングの形を目指すこと**
      - 細かくアップデートを繰り返すことで、いつの間にか「なんでも測定する」習慣が身に付く

- AWSなどでマネージドサービスを利用する際はベンダーロックインで乗り換えコストも高いから、利用する時は乗り換え先を考慮した方が良い
  - マネージドサービスが何をラップしたサービスなのかを意識する
  - ツール導入時はちゃんと撤退案までセットで考え、撤退の判断基準や撤退方法も考える
  - 新技術を取り入れる際の観点
    1. 新技術の既知のリスク
    2. どのような未知の不確定要素にぶつかるか
    3. 既存の技術で解決できないどのような問題を解決しようとしているのか

- 非難のない文化を作るには、問題が発生した際にそれを共有することで関係者に不利益を与えないことを明確にすることが大切
  - **詳しく事象について説明したくれた人の安全性を向上させることが大切**
  - これが知識の共有へのハードルを下げ、コラボレーションやアフィニティの向上につながる

## ツールの問題解決
- 1つのツールにする合意が得られない、社員がツールの導入(廃止)に抵抗する
  - そもそも規模が全員の合意を取るのは難しいことを理解する
  - 日常的にツールを利用する人の意見を積極的に聞き、彼らのニーズやユースケースを最適化するようにすれば、ハレーションは起きにくい
  - 変更前には、あらかじめ変更を知らせたり、意見を聞くことでプロセスに参加させ納得感を持ってもらうことが抵抗を減らす
  - 導入(廃止)する際は、移行期間を設けて、徐々に導入していくことで、社員の抵抗を減らす

***

# 第5部 : スケーリング
- **スケーリングとは、企業がライフサイクルを通じて発展、成長、進化していくこと**
  - スケーリングは企業の規模やフェーズによって様々。大企業 or スタートアップ のように単純化できるものではない。
  - 大企業でもスタートアップでも目的は同じ。 ※ 手段が異なるだけ
- 組織が成功するには、必要に応じて組織を拡大/縮小することが重要

## スケーリングするために意識すべきこと
  - 銀の弾丸はないと理解すること
    - **①システムをどのように動作させるか？**, **②大局的に見て今大切なことは何か？** を理解することが重要
    - ①,②を理解すれば、組織内で柔軟にして良い部分といけない部分を意識的に決めることができる
    - ex) 「モノリスよりマイクロサービスが優れている」ではなく、今の組織やシステムにとってどちらが適しているかを考えることができる
  - タスクから属人性を排除する
    - 属人性のあるタスクがあると、そのタスクが担当者に依存してしまいスケールが遅くなる

## 組織の構造
- 【大前提】**チームがどのような構造であれ、組織全体の活力を保つためには、チーム間のコミュニケーションが重要**
- 組織構造とメリット / デメリット
  | 組織構造 | メリット | デメリット |
  |:-----------|:------------|:------------|
  | 小さな組織横断チーム | プロダクトを運営するスキルがチームに揃い、チーム内のコンテキストも高くなるため、スケールしやすい | 専門的なナレッジがたまりにくい |
  | 単一職能チーム     | 専門的なナレッジが溜まりやすい | スケールしにくい |
- チーム規模による柔軟性
  | チーム規模 | 人数 | 特徴 |
  |:-----------|:-----|:-----|
  | 小規模チーム | 〜5人 | リソースが足りなく、タスクに追われがち |
  | 中規模チーム | 5〜7人 | チームが増えると管理職やリーダーが増える |
  | 大規模チーム | 9人〜 | スピード感を持った意思決定が苦手 |

  - 中規模チームでは **「管理職は昇進ではなく、キャリア変更だ」** という文化を持たせることが重要
    - この文化を維持するには、内部からの昇進が極めて重要
    - 有能 かつ 人間関係の調整に力を注ぐキャリア に関心を持つ人を昇進させるべき

## 組織のライフサイクル
- PJの整理
  - 組織が変化していく時期が、組織をクリーンにするための絶好の機会
  - 組織に価値を与えていないPJを判断し、整理する必要がある
    - 価値を与えていないPJのメンバー全員との話し合いをすることが大切
    - 組織の状況を理解してもらう機会を与えることで反発を抑えることができる
    - PJの整理に対して反発する社員は、情熱を持って仕事している社員なので、むしろその情熱を別PJにむけてもらうように意識することでより組織のためになるチャンス
- リリースサイクルの影響
  - **「リリースサイクルを早くすること = 絶対的正義」ではない！**
  - どのようなリリースサイクルが適しているかはプロダクトの特性やコンテキストによって変わるもの
  - プロダクト側の都合だけではなく、リリースによってユーザーがどういう影響を受けるかも意識すべき
  - リリースにまつわるあらゆる影響やその範囲を加味してサイクルは決める

## チームのスケーリング
- 【大前提】仕事の目的や責任を共通のものとして全チームが認識していれば、チームは効果的に強調し協力できる。
  - ❌ 人を職務に縛り付けたり、恐怖駆動で動く組織は **「私たちの仕事」** ではなく **「私の仕事」** の最適化を誘発する
- スケーリングとしての採用
  - スケールの手段として自動化が選ばれがちだが、自動化には罠もある
    - どんなに自動化しても完全に人が要らなくわけではない
    - 自動化が複雑になればなるほど、トラブルシューディングのために人を介する必要がある
    - ❌ 自動化の目的が「コスト削減」であるのはアンチパターン(あくまで副次的効果)
  - アウトソーシングの注意点
    - 外注は組織のアフィニティが失われやすい分、コストも上がる
    - **「外注する = 丸投げする」ではない！！外注先とのコミュニケーションを取ることが大切**
    - ⭕️ 外注先は立場が弱くなりがちなので、発注元の表彰の機会に読んだりすることで、アフィニティが失われるのを抑えるのも良い
    - 責任問題は起きがちなので、あらかじめ明確に責任分担を決めることが大切

## チームのスケーリングと成長戦略
- チームを強化するための戦略
  - チームを小さく柔軟なものに保つ
    - **組織全体でdevops共同体の有効性を保つために、チームの規模は小さく保つべき！**
    - 知識が個人に偏っている状態は、ボトルネックになりやすい(チームを小さく保てていない兆候)
    - グループの最適な人数は4.6人(研究結果によるもの)
    - **「これ以上はチームの人数を増やすしかないよね」がチームを分割する際の基準**
      - 基本的に同じ仕事をすると段々、効率は良くなる
      - これ以上、効率を良くできない(よくするには人を増やすしかない)状態 = 小さく保つメリットが最大である状態
      - これ以上増やすと、コミュニケーションコストの肥大化や、結束力の低下などデメリットの方が大きくなる
  - コラボレーションを育てる
    - 生産的なチームは **「密接にコミュニケーションを取り合い、平等に参加し、空気を読むスキルを持っている」**
    - 優秀で協調や協力を大切にするチームの特徴
      - 持ちつ持たれつの関係である(互いにGiveし合っている)
      - 個人とグループが説明責任を果たしている
        - **人は自由が与えられれば自分のベストを尽くしたいと思うもの**
        - 全員が質の高い仕事をしていると思っている状態 = チーム全体が信頼、共通の価値観、結束力がある状態
        - この状態のチームは、問題発生から退所までの時間が短くなる
  - 摩擦や対立をうまく捌く
    - 対立があるのは健全な組織である証拠
      - 対立がない組織 = メンバーが同一的で多様性がない
      - 大事なのは対立に対して適切に対処すること。対立が起きるのは悪くない。むしろ良いこと。
      - ハラスメントなどはNGだが、対立はOK
    - 個人が感じる対立は基本的には1on1で早期解決を図る
      - ※ ただし個人と組織全体の方向性が合わない場合は、割り切って組織を離れることを後押しする選択肢もあり
      - ※ 仕方ないことと割り切るのがお互いのため
    - チーム全体で感じる対立は、経営やマネジメントの責任
      - いつから起きていたか、チームに対する期待値は適切かを判断する責任がある

***

# 第6部 : devops文化への架け橋

***
