---
title: "フロントエンド開発のためのテスト入門 ~ カバレッジレポート ~"
tags: ["フロントエンド", "テスト", "書籍"]
---

# カバレッジレポート

- `npx jest --coverage`でカバレッジレポートを出力できる
- `jest.config.js`の設定で、カバレッジレポートの出力先を変更できる
  - `coverageDirectory`で指定( デフォルトは`./coverage` )
  - `open ./coverage/lcov-report/index.html`でレポートのGUIが見れる
  ```js
  module.exports = {
    // ...
    collectCoverage: true,
    coverageDirectory: './coverage',
    // ...
  }
  ```

## レポートの構成
| File | Stmts | Branch | Funcs | Lines | Uncovered Line |
| :--: | :--: | :--: | :--: | :--: | :--: |
| ファイル名 | 命令網羅率 | 分岐網羅率 | 関数網羅率 | 行網羅率 | 網羅されていない行 |

- 命令網羅率
  - 全部の命令が実行されてる？？
- 分岐網羅率
  - 全部の条件分岐、通ってる？？
- 関数網羅率
  - 全部の関数呼ばれてる？？ (呼ばれていない関数ないよね？？)
- 行網羅率
  - 全部の行、実行されてる？？ (無駄なコードないよね？？)

## テストをSkipさせる
- `xtest`とすることで、テストをSkipすることができる(実行されないので、カバレッジレポートにも反映されない)
```ts
// NOTE: 実行される
  test("朝は「おはよう」を返す", () => {
    jest.setSystemTime(new Date(2023, 4, 23, 8, 0, 0));
    expect(greetByTime()).toBe("おはよう");
  });
  // NOTE: 実行されない
  xtest("昼は「こんにちは」を返す", () => {
    jest.setSystemTime(new Date(2023, 4, 23, 14, 0, 0));
    expect(greetByTime()).toBe("こんにちは");
  });
```

## カバレッジをCIに組み込む
- カバレッジは定量指標になるので、PJによってはCIに組む鋳込み「カバレッジが〇〇%以下なら、CIを通さない」という設定にすることもある
  - 大規模なシステム以外は向かなそう?(個人的な意見)
- **※ 数値が高い = テストの品質が高い とは限らない!!!**
  - カバレッジが高いだけで、バグがないことの証明などにはならない
  - **逆に、カバレッジが低い = テストが不足している は正しい**

## カスタムレポーター
- `jest.config.js`にレポーターを追記することで、さまざまなレポーターを通してカバレッジを確認できる
  - ex) `jest-html-reporters`では、実行結果をグラフ化して表示
