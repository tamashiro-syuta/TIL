# 達人に学ぶDB設計徹底指南書

## 知りたいこと
- DB設計(モデル設計)のアンチパターンとベストプラクティス
  - 物理設計はそこまで要らない(だいたいフルマネージドなクラウド使うことが多いから)
- 今まで設計してきたDBの設計がどれくらい正しいかを知りたい
  - 同時に良くなかった設計があれば、どう改善できたか知りたい

***

## はじめに と おわりに の要約
- 論理設計と物理設計はどちらも大事でトレードオフの関係
- だが、優先するべきは論理設計
  - 物理設計はハードの品質が上がれば解決されるが、論理設計はそうはいかない
- 基本は論理設計が優先だけど、パフォーマンスがシビアな時には物理設計も考慮して設計した方が良いよね

***

## 第1章 データベースを制する者はシステムを制す
- DOA >>> POA
  - DOA(Data Oriented Approach): データを中心に設計しようね、データは一元管理しようね
    - プログラミングする前に、まずはDBの設計から!!!
  - POA(Process Oriented Approach): プロセスを中心に設計しようね
    - まずはプログラムを書いて、DBの設計は後回し!!!
  - 言わずもがなだが、DB設計の方が大事。プログラムよりDB設計の方が変更しにくいし、長生きだからちゃんと作っていた方が良い

### 3層スキーマ
- 外部スキーマ: ビュー
  - ユーザーが見るデータみたいなイメージ
  - レコードの一部だけを取り出して表示する的なやつ
    - ex) テーブル的にはA,B,Cの3つのカラムがあるけど、ビュー的にはAだけを表示する。この時、ユーザーから見えるデータ(外部スキーマ)はAだけ
  - Railsでいうところの`view`のこと
- 概念スキーマ: テーブル
  - 開発者が意識しているスキーマ
  - Railsでいうところの`schema.rb`のこと
  - テーブル構成、テーブル同士の関係などを定義
  - 概念スキーマは、外部スキーマと内部スキーマの間に位置し、緩衝材のような役割を果たす = "データ独立性"
    - 外部スキーマ(ユーザーに見せるデータ)を変更したい！ → 概念スキーマから取り出す値を変更するだけでOK
    - 内部スキーマを変更したい!(データの保持の仕方) → 概念スキーマは変更せず、内部スキーマだけ変更すればOK(概念スキーマの定義通りであればどう保持しようがOK)
- 内部スキーマ: ファイル
  - RDBMSから見たスキーマ
  - 開発者が定義した概念スキーマをDB内部ではどのように保存しているか？を定義しているスキーマ

***

## 第2章 論理設計と物理設計
- **DBの性能問題は、8割はストレージのI/Oによって起きている!!!**

### パフォーマンスのサイジング
- 性能要件は以下の2つの指標で定義される
  - 処理時間: 「○秒以内に処理が終了するか」= 時間
  - スループット: 「一定時間内でどれだけ早く処理できるか」= スピード
- システムの初期段階では、性能要件を定義するのは難しいため、以下の定義方法がおすすめ
  1. 類似の稼働中システムから流用
    - 簡単だけど、類似度合いで精度が変わる
  2. プロトタイプで性能検証
    - 正確だが、コストがかかる

### ストレージの冗長構成
- RAID = 冗長化(副作用で性能向上)
  - パフォーマンスの原因であるディスクI/Oも、アクセスが分散されるので性能向上にもなる
- 冗長化する際の検討事項
  - 「そもそも、冗長化する必要ってある？」
    - する必要ないシステムに適用するとコストが上がるだけ
  - 「どんくらい冗長化する？」
    - RAID 0
      - 冗長化しないけど、ディスクは増やすから性能は上がるよ
    - RAID 1
      - ミラーリング(同じデータを2本のディスクそれぞれに保存)
      - データの信頼性が上がる(性能は変わらない)
    - RAID 5
      - 通称 パリティ分散
      - なんかよくわからんけど、「パリティ」ってやつに情報いれてデータを復元できるようにするらしい
      - 最低でも3本のディスクが必要
      - 冗長化しつつ、性能も向上する
    - RAID 10
      - RAID 1 + RAID 0
      - 最低でも4本のディスクが必要
      - ミラーリング + ストライピング で性能と信頼性を両立させる
- RAIDの採用基準
  - 最低でもRAID 5。お金に余裕があればRAID10。
  - RAID 0は論外
***

## 第3章 論理設計と正規化

***

## 第4章 ER図 ~複数のテーブルの関係を表現する~

***

## 第5章 論理設計とパフォーマンス ~正規化の欠点と非正規化~

***

## 第6章 データベースとパフォーマンス

***

## 第7章 論理設計のバッドノウハウ

***

## 第8章 論理設計のグレーノウハウ

***

## 第9章 一歩進んだ論理設計 ~SQLで木構造を扱う~
