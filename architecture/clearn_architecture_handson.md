---
title: "「手を動かしてわかるクリーンアーキテクチャ」のメモ"
tag: "アーキテクチャ"
---

# 📝「手を動かしてわかるクリーンアーキテクチャ」のメモ

## 目的
  - 業務で触っているシステムがオニオンアーキテクチャやDDDに近い構成なので、それらの理解を深めるために読む
    - クリーンアーキテクチャと思って書籍買ったけど勘違いだったw
    - まあでも、近い構成だと思うので、エッセンスだけ取り入れたい
  - 今まではMVCフレームワークしか使ったことないので、他のアーキテクチャへの理解を触れてみる

***

# 保守容易性
- 様々ある品質要求において、「保守容易性」が一番重要
  - そのほかの全ての要素に影響を与えるため
- 保守性が低いと変更コストが上がり、エンジニアと非エンジニアの衝突が起きやすくなる
- だから、保守容易性の高いアーキテクチャを採用しようね

***

# 従来の多層アーキテクチャの何が問題なのか？
## 前提
- 保守容易性が重要なので、アーキテクチャはそれを実現するために設計される必要がある
  - 「RLS使いたいからMySQLからPostgreSQLに変えてね〜」って言われても対応できるように
  - 従来のアーキテクチャだとそれが難しい

## 従来の多層アーキテクチャとは
- Web層、ドメイン層、永続化層の3層構成
  - たぶんRailsで言うと、Web層がコントローラ、ドメイン層がモデル、永続化層がDB周り
- 依存の流れは、Web層 👉 ドメイン層 👉 永続化層
- アーキテクチャのルール
  - 上位層は自身と同じかそれ以下の層にアクセスできる
  - 下位層は上位層にアクセスできない(依存の流れに逆らわない)

## 何が問題？
- DB中心のアプローチ
  - DBのスキーマ変更がアプリケーション全体に影響を与える
- DB中心ではアプリを設計する際にDBのスキーマから設計する
  - アプリの目的は特定のドメインの課題を解決すること
  - ってことは本来は、**ドメイン(ビジネスロジック)を中心に設計すべき**
  - ドメインから設計できれば、エンジニアが技術的な要素を無視してドメインの設計に集中できる
  - でも依存の流れで、どうしてもDB中心になってしまう
- 「従来のアーキテクチャ × ORM」でよりDB中心が進む
  - ORMを使うことで、よりドメイン層と永続化層が密結合になりやすい
    1. エンティティが永続化層にある
    2. ドメイン層からエンティティにアクセスできる
    3. ドメイン層が永続化層の関心事まで扱う
        - Railsでもモデルは一般的にビジネスロジック〜DBまでを責務としている
    4. ドメイン層と永続化層が密結合になる
        - ドメイン層のコードに影響を与えずに永続化層のコードを変更するのが難しくなる

  ![従来の多層アーキテクチャ](/image/architecture/clean_architecture_handson/orm_with_mvc_architecture.jpg)

***
