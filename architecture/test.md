---
title: "「手を動かしてわかるクリーンアーキテクチャ」のメモ"
tag: "アーキテクチャ"
---

# 依存権系の逆転
[ Q ] 依存関係を逆転させてドメイン中心で設計するのはわかったけど、どうやって逆転すんねん。。。

クリーンアーキテクチャにおいて、
単一責任の原則はWhy(ベースとなる考え方、なんでそうするのか？)で、
依存性逆転の原則はHow(どうやって実現するのか？)

## 単一責任の原則
- 単一責任の原則 = コンポーネントを変更する理由は、1つだけになるようにすべき
- クリーンアーキテクチャにおける単一責任の原則は「Why?(なんでそうするの?)」
  - ドメイン中心にするには、ドメインが他のコンポーネントに依存しないようにしないとね
  - そのためには、ドメイン層が単一責任の原則を守らないとね
  - 全部の層で依存なしは無理だし、ドメインが中心になるように内部の層にいくにつれて依存を減らしていくよ

## 依存関係逆転の原則
- 依存関係逆転の原則 = コードベース内の依存関係は、いかなるものであっても、その方向を逆転することができる
- クリーンアーキテクチャにおける依存関係逆転の原則は「How?(どうやって依存関係を逆転させるの?)」
  - 逆転させたいコンポーネントの`interface`を内側の層に定義する
  - 外側の層は内側の層の`interface`を実装する
  - そうすることで、層単位で見た時に外側の層が内側の層に依存するようになる

## クリーンアーキテクチャの各層の概要
![clean_architecture](/image/architecture/clean_architecture_handson/clean_architecture.jpg)

### 🟨 エンタープライズビジネスルール層(図の黄色)
- エンティティ
- ドメイン層の中心
- 他の層に依存しない
- ドメインに登場する「概念」を表現する
- ドメインの関心事(ビジネスルール)を実装する
  <details>
    <summary>ユースケースとの違い</summary>

    - エンティティ: アプリケーションの有無に関わらず、業務として行えること
    - ユースケース: アプリケーションの場合にのみ発生すること
  </details>
### 🟥 アプリケーションビジネスルール層(図の赤色)
- エンティティを操作する
- 一般的にサービス層と呼ばれるもの
  - 単一の責任しか持たないように扱うものの粒度をより細かくしたもの
- アプリケーションの関心ごとを実装する

### 🟩 インターフェースアダプタ層(図の緑色)
- ビジネスルールをサポートするもの(コントローラー、ゲートウェイ、プレゼンターなど)
  - 🟥 ユースケース と 🟦 外部のインターフェースをつなぐ役割
  - ex: 永続化、UI、外部接続、デバイス

### 🟦 フレームワーク、ドライバ層(図の青色)
- Web、UI、外部接続、DB、デバイスなど
- 使用しているWebフレームワーク(echoなど)や、データベースドライバなどの外部ライブラリの設定や初期化を行う層
- echo使った際のルートのmain.goもここに当たるよ byGPT

***
